<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static', filename='src/output.css') }}">
  <script src="https://cdn.tailwindcss.com"></script>
  <title>Orders</title>
</head>

<body class="bg-gray-100 min-h-screen">

  <main class="max-w-7xl mx-auto p-4 sm:p-6">

    <!-- Page Title -->
    <div class="mb-6">
      <h1 class="text-2xl font-semibold text-gray-800">Orders</h1>
      <p class="text-sm text-gray-500">Manage and track customer orders</p>
    </div>

    <form method="GET" class="flex flex-col sm:flex-row gap-2 mb-4">
        <input type="text" name="q" value="{{ search }}" placeholder="Search by customer"
                class="border rounded px-3 py-2 w-full sm:w-64">
        
        <select name="status" class="border rounded px-3 py-2 w-full sm:w-48">
            <option value="">All Statuses</option>
            <option value="Pending" {% if status_filter=='Pending' %}selected{% endif %}>Pending</option>
            <option value="Paid" {% if status_filter=='Paid' %}selected{% endif %}>Paid</option>
            <option value="Shipped" {% if status_filter=='Shipped' %}selected{% endif %}>Shipped</option>
            <option value="Completed" {% if status_filter=='Completed' %}selected{% endif %}>Completed</option>
            <option value="Cancelled" {% if status_filter=='Cancelled' %}selected{% endif %}>Cancelled</option>
        </select>

        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
            Filter
        </button>
    </form>


    <!-- ================= MOBILE CARDS ================= -->
    <div class="space-y-4 sm:hidden">
      {% for order in orders.items %}
      <div class="bg-white rounded-xl shadow-sm p-4">
        <div class="flex justify-between items-center">
          <span class="font-semibold text-gray-800">Order #{{ order.id }}</span>
          <span class="text-sm text-gray-500">
            {{ order.created_at.strftime('%d %b %Y') }}
          </span>
        </div>

        <p class="mt-2 text-sm text-gray-600">
          Customer: <strong>{{ order.user_name }}</strong>
        </p>

        <p class="mt-1 text-sm text-gray-600">
          Total: <strong>KSh {{ order.total_amount }}</strong>
        </p>

        <div class="mt-3">
          <span class="px-3 py-1 rounded-full text-xs font-medium
            {% if order.status == 'Pending' %} bg-yellow-100 text-yellow-700
            {% elif order.status == 'Paid' %} bg-blue-100 text-blue-700
            {% elif order.status == 'Shipped' %} bg-purple-100 text-purple-700
            {% elif order.status == 'Completed' %} bg-green-100 text-green-700
            {% else %} bg-red-100 text-red-700 {% endif %}
          ">
            {{ order.status }}
          </span>
        </div>

        <a href="{{ url_for('admin.view_order', order_id=order.id) }}"
           class="inline-block mt-4 text-blue-600 font-medium hover:underline">
          View Order â†’
        </a>
      </div>
      {% endfor %}
    </div>

    <!-- ================= DESKTOP TABLE ================= -->
    <div class="hidden sm:block bg-white rounded-xl shadow-sm overflow-x-auto">
      <table class="w-full text-sm">
        <thead class="bg-gray-50 text-gray-600 uppercase text-xs">
          <tr>
            <th class="p-4 text-left">Order</th>
            <th class="p-4 text-left">Customer</th>
            <th class="p-4 text-left">Total</th>
            <th class="p-4 text-left">Status</th>
            <th class="p-4 text-left">Date</th>
            <th class="p-4 text-right">Action</th>
          </tr>
        </thead>

        <tbody class="divide-y">
          {% for order in orders.items %}
          <tr class="hover:bg-gray-50 transition">
            <td class="p-4 font-medium text-gray-800">
              #{{ order.id }}
            </td>
            <td class="p-4">{{ order.user_name }}</td>
            <td class="p-4">KSh {{ order.total_amount }}</td>
            <td class="p-4">
              <span class="px-3 py-1 rounded-full text-xs font-medium
                {% if order.status == 'Pending' %} bg-yellow-100 text-yellow-700
                {% elif order.status == 'Paid' %} bg-blue-100 text-blue-700
                {% elif order.status == 'Shipped' %} bg-purple-100 text-purple-700
                {% elif order.status == 'Completed' %} bg-green-100 text-green-700
                {% else %} bg-red-100 text-red-700 {% endif %}
              ">
                {{ order.status }}
              </span>
            </td>
            <td class="p-4 text-gray-600">
              {{ order.created_at.strftime('%d %b %Y') }}
            </td>
            <td class="p-4 text-right">
              <a href="{{ url_for('admin.view_order', order_id=order.id) }}"
                 class="text-blue-600 font-medium hover:underline">
                View
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="flex justify-between items-center mt-6 text-sm text-gray-600">
      <span>Page {{ orders.page }} of {{ orders.pages }}</span>
      <div class="flex gap-2">
        {% if orders.has_prev %}
          <a href="?page={{ orders.prev_num }}"
             class="px-3 py-1 border rounded hover:bg-gray-100">Prev</a>
        {% endif %}
        {% if orders.has_next %}
          <a href="?page={{ orders.next_num }}"
             class="px-3 py-1 border rounded hover:bg-gray-100">Next</a>
        {% endif %}
      </div>
    </div>

  </main>
</body>
</html>
